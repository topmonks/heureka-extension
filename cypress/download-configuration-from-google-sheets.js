/* See cypress/README.md for more info about this */

const fs = require("fs");
const Tabletop = require("tabletop");

(async () => {
  const results = await Tabletop.init({
    key: "https://docs.google.com/spreadsheets/d/1FBfQlYsWDWpeFG29WNvQX8kPe5_jU15joAFQseFPlvk/",
    orderby: "domain",
    wanted: ["Main"]
  })
    .then(res => res.Main.elements)
    .then(rows => rows.filter(row => !row.IGNORE))
    .then(rows => rows.map(row => {
      delete row.IGNORE; // eslint-disable-line no-param-reassign
      return row;
    }));

  fs.writeFileSync(
    // Using .js instead .json so I can use comments
    "./cypress/config.js",
    [
      "// This file is generated by running `npm run download-configuration-from-google-sheets`",
      "\n",
      "/* eslint-disable */",
      "\n\n",
      "module.exports = ",
      JSON.stringify(results, null, "\t")
    ].join("")
  );
})();
